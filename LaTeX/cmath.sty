% CMATH 2022
% <chris@clr.is>


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cmath}[2022 CMath]

\RequirePackage{xparse}
\RequirePackage{mathtools}
\RequirePackage{amssymb}
\RequirePackage{amsthm}


% Defining simple shortcuts
\def\dee{\mathrm{d}}
\def\bb{\mathbb}
\def\scr{\mathscr}
\def\cal{\mathcal}
\def\grad{\nabla}


% Operators and other symbols
\DeclareMathOperator*{\argmin}{ arg\,min }
\DeclareMathOperator*{\argmax}{ arg\,max }
\DeclareMathOperator*{\bigo}{ \mathcal{O} }
\DeclareMathOperator*{\E}{ \bb{E} }
\DeclareMathOperator*{\prob}{ \bb{P} }
\DeclareMathOperator*{\Var}{ Var }
\DeclareMathOperator*{\Cov}{ Cov }
\DeclareMathOperator*{\Corr}{ Corr }
\DeclareMathOperator*{\Arg}{ Arg }
\let\Im\relax \DeclareMathOperator*{\Im}{ \mathfrak{I} }
\let\Re\relax \DeclareMathOperator*{\Re}{ \mathfrak{R} }
\DeclareMathOperator*{\lxor}{ \veebar }


% Linear Algebra
\renewcommand*\env@matrix[1][*\c@MaxMatrixCols c]{%
  \hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{#1}}
\newcommand{\pvec}[1]{\begin{pmatrix} #1 \end{pmatrix}}

\PassOptionsToPackage{bold-style=ISO}{unicode-math}
\AtBeginDocument{%
    \@ifpackageloaded{unicode-math}{%
        \newcommand{\vb}{\symbf}

        \newcommand{\mb}{\symbf}%  Matrices should be bold?
        % \newcommand{\mb}[1]{#1}% Matrices oughtn't be bold?
    }{%
        \RequirePackage{bm}
        \newcommand{\vb}{\bm}


        \newcommand{\mb}{\bm}%  Matrices should be bold?
        % \newcommand{\mb}[1]{#1}% Matrices oughtn't be bold?
    }%
}


% Calculus
\newcommand{\cderiv}[3][]{ \frac{ {\dee}^{#1} #2 }{ \dee #3^{#1} } }
\newcommand{\cpartial}[3][]{ \frac{ {\partial}^{#1} #2 }{ \partial #3^{#1} } }
\newcommand{\cint}[2][]{\int#1 \! #2 \,}


% Non-specific stuff
\@ifpackageloaded{xcolor}{%
\makeatletter
\renewcommand*{\@textcolor}[3]{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother%
}{}

\newcommand{\codspace}{%
\mathchoice%
    {\mkern18mu}%
    {\mkern2mu}%
    {\mkern1mu}%
    {\mkern1mu}%
}
\renewcommand{\pod}[1]{\codspace(#1)}
\renewcommand{\mod}[1]{\codspace\operatorname{mod}\,\,#1}
\newcommand{\nsmod}[1]{\,\operatorname{mod}\,#1}

\NewDocumentEnvironment{subproof}{ O{Subproof} O{\(\square\)} }{%
    \renewcommand{\qedsymbol}{#2}%
    \par\noindent \textit{#1}%
}{%
    \hfill \qedsymbol%
    \vspace{1ex}%
}


% Deprecated
\newcommand{\cdims}[3][\bb{R}]{#1^{#2 \times #3}}